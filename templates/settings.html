<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Beeah CMS</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/accommodation.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
    <style>
        .theme-options { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        .theme-btn { padding: 20px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; font-weight: 600; text-align: center; transition: transform 0.2s, box-shadow 0.2s; }
        .theme-btn:hover { transform: translateY(-3px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .theme-swatch { width: 20px; height: 20px; border-radius: 50%; display: inline-block; margin-right: 10px; vertical-align: middle; border: 1px solid #ccc;}
    </style>
</head>
<body>
    <div class="top-header">
        <div class="header-left">
            <img src="{{ url_for('static', filename='images/logo1.png') }}" alt="Logo 1" class="header-logo">
        </div>
        <div class="header-center">
            <h1>Settings</h1>
        </div>
        <div class="header-right">
             <a href="{{ url_for('auth_bp.dashboard') }}" class="back-btn">Back to Dashboard</a>
            <img src="{{ url_for('static', filename='images/logo2.png') }}" alt="Logo 2" class="header-logo">
        </div>
    </div>

    <div class="page-container">
        <nav class="sidebar">
            <ul>
                <li><a href="{{ url_for('auth_bp.dashboard') }}">Dashboard</a></li>
                <li><a href="{{ url_for('acc_bp.accommodation_data') }}">Accommodation Data</a></li>
                <li><a href="{{ url_for('maintenance_bp.maintenance_report') }}">Maintenance Report</a></li>
                <li><a href="{{ url_for('amcs_bp.amcs_report') }}">Amcs Services</a></li>
                <li><a href="{{ url_for('assets_bp.assets_report') }}">Asset reports</a></li>
                <li><a href="{{ url_for('store_bp.store_report') }}">Store Record</a></li>
                <li><a href="{{ url_for('contracts_bp.contracts_report') }}">Contracts</a></li>
                <li class="active"><a href="{{ url_for('settings_bp.settings_page') }}">Setting</a></li>
            </ul>
        </nav>

        <main class="main-content">
            {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}
                <div class="flash-message">{{ messages[0][1] }}</div>
              {% endif %}
            {% endwith %}

            {% if session.get('role') == 'Admin' %}
            <div class="settings-section">
                <h2>User Management</h2>
                <div class="content-body">
                    <div class="summary-section">
                        <h3>Add New User</h3>
                        <form class="staff-form" method="POST" action="{{ url_for('settings_bp.add_user') }}">
                            <div class="form-row">
                                <div class="form-group"><label>Username</label><input type="text" name="username" required></div>
                                <div class="form-group"><label>Email</label><input type="email" name="email"></div>
                            </div>
                             <div class="form-row">
                                <div class="form-group"><label>Password</label><input type="password" name="password" required></div>
                                <div class="form-group">
                                    <label>Role</label>
                                    <select name="role">
                                        <option value="Manager">Manager</option>
                                        <option value="Camp boss">Camp Boss</option>
                                        <option value="Coordinator">Coordinator</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group full-width">
                                <label>Allowed Accommodations (for Camp Boss/Coordinator)</label>
                                <select name="allowed_accommodations" multiple size="4">
                                    {% for acc in accommodations %}<option value="{{ acc }}">{{ acc }}</option>{% endfor %}
                                </select>
                            </div>
                            <div class="form-actions"><button type="submit" class="submit-btn">Add User</button></div>
                        </form>
                    </div>
                    <div class="table-container full-width">
                        <h3>Existing Users</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Allowed Accommodations</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for user in users %}
                                <tr>
                                    <td>{{ user.username }}</td>
                                    <td>{{ user.email }}</td>
                                    <td>{{ user.role }}</td>
                                    <td>{{ user.allowed_accommodations|join(', ') }}</td>
                                    <td>
                                        {% if user.username != 'admin' %}
                                        <a href="{{ url_for('settings_bp.edit_user', username=user.username) }}" class="action-btn-sm">Edit</a>
                                        <form method="POST" action="{{ url_for('settings_bp.delete_user', username=user.username) }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this user?');">
                                            <button type="submit" class="danger-btn-sm">Delete</button>
                                        </form>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}

            <div class="settings-section">
                <h2>Theme Customization</h2>
                <p>Select a theme for the application. Your choice will be saved.</p>
                <div class="theme-options">
                    <button class="theme-btn" onclick="setTheme('default')"><span class="theme-swatch" style="background: #0a2540;"></span>Default Dark</button>
                    <button class="theme-btn" onclick="setTheme('light_blue')"><span class="theme-swatch" style="background: #1E90FF;"></span>Light Blue</button>
                    <button class="theme-btn" onclick="setTheme('forest_green')"><span class="theme-swatch" style="background: #228B22;"></span>Forest Green</button>
                    <button class="theme-btn" onclick="setTheme('midnight_black')"><span class="theme-swatch" style="background: #1a1a1a;"></span>Midnight Black</button>
                    <button class="theme-btn" onclick="setTheme('slate_grey')"><span class="theme-swatch" style="background: #465461;"></span>Slate Grey</button>
                    <button class="theme-btn" onclick="setTheme('sunrise_orange')"><span class="theme-swatch" style="background: #FF8C00;"></span>Sunrise Orange</button>
                    <button class="theme-btn" onclick="setTheme('royal_purple')"><span class="theme-swatch" style="background: #6A0DAD;"></span>Royal Purple</button>
                    <button class="theme-btn" onclick="setTheme('ocean_breeze')"><span class="theme-swatch" style="background: #008B8B;"></span>Ocean Breeze</button>
                    <button class="theme-btn" onclick="setTheme('crimson_red')"><span class="theme-swatch" style="background: #DC143C;"></span>Crimson Red</button>
                    <button class="theme-btn" onclick="setTheme('sandy_desert')"><span class="theme-swatch" style="background: #D2B48C;"></span>Sandy Desert</button>
                </div>
            </div>
        </main>
    </div>
</body>
</html>